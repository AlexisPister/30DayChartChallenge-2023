import{D as L}from"./transform.3e593064.js";import{z,i as $,a8 as O,q as S,M as Y,j,c as B,a as C,b as D,a9 as E,d as y,y as k,aa as N}from"./plot.9c3b00f8.js";import{m as R,s as _}from"./dot.25e40388.js";import{e as x}from"./band.27971c68.js";import{r as Z}from"./range.6bc2a9a0.js";function A(e,t,r){var s=1e-8,i=t-1,c=r-1,l=0,f,h,o,n,u,p,a,d,v,m,g;if(e<=0)return 0;if(e>=1)return 1;for(t>=1&&r>=1?(o=e<.5?e:1-e,n=Math.sqrt(-2*Math.log(o)),a=(2.30753+n*.27061)/(1+n*(.99229+n*.04481))-n,e<.5&&(a=-a),d=(a*a-3)/6,v=2/(1/(2*t-1)+1/(2*r-1)),m=a*Math.sqrt(d+v)/v-(1/(2*r-1)-1/(2*t-1))*(d+5/6-2/(3*v)),a=t/(t+r*Math.exp(2*m))):(f=Math.log(t/(t+r)),h=Math.log(r/(t+r)),n=Math.exp(t*f)/t,u=Math.exp(r*h)/r,m=n+u,e<n/m?a=Math.pow(t*m*e,1/t):a=1-Math.pow(r*m*(1-e),1/r)),g=-M(t)-M(r)+M(t+r);l<10;l++){if(a===0||a===1)return a;if(p=F(a,t,r)-e,n=Math.exp(i*Math.log(a)+c*Math.log(1-a)+g),u=p/n,a-=n=u/(1-.5*Math.min(1,u*(i/a-c/(1-a)))),a<=0&&(a=.5*(a+n)),a>=1&&(a=.5*(a+n+1)),Math.abs(n)<s*a&&l>0)break}return a}function F(e,t,r){var s=e===0||e===1?0:Math.exp(M(t+r)-M(t)-M(r)+t*Math.log(e)+r*Math.log(1-e));return e<0||e>1?!1:e<(t+1)/(t+r+2)?s*q(e,t,r)/t:1-s*q(1-e,r,t)/r}function q(e,t,r){var s=1e-30,i=1,c=t+r,l=t+1,f=t-1,h=1,o=1-c*e/l,n,u,p,a;for(Math.abs(o)<s&&(o=s),o=1/o,a=o;i<=100&&(n=2*i,u=i*(r-i)*e/((f+n)*(t+n)),o=1+u*o,Math.abs(o)<s&&(o=s),h=1+u/h,Math.abs(h)<s&&(h=s),o=1/o,a*=o*h,u=-(t+i)*(c+i)*e/((t+n)*(l+n)),o=1+u*o,Math.abs(o)<s&&(o=s),h=1+u/h,Math.abs(h)<s&&(h=s),o=1/o,p=o*h,a*=p,!(Math.abs(p-1)<3e-7));i++);return a}function M(e){var t=0,r=[76.18009172947146,-86.5053203294167,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],s=1.000000000190015,i,c,l;for(l=(c=i=e)+5.5,l-=(i+.5)*Math.log(l);t<6;t++)s+=r[t]/++c;return Math.log(2.506628274631*s/i)-l}function W(e,t){var r=A(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}const G={ariaLabel:"linear-regression",fill:"currentColor",fillOpacity:.1,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class P extends Y{constructor(t,r={}){const{x:s,y:i,z:c,ci:l=.95,precision:f=4}=r;if(super(t,{x:{value:s,scale:"x"},y:{value:i,scale:"y"},z:{value:j(r),optional:!0}},r,G),this.z=c,this.ci=+l,this.precision=+f,!(0<=this.ci&&this.ci<1))throw new Error(`invalid ci; not in [0, 1): ${l}`);if(!(this.precision>0))throw new Error(`invalid precision: ${f}`)}render(t,r,s,i,c){const{x:l,y:f,z:h}=s,{ci:o}=this;return B("svg:g",c).call(C,this,i,c).call(D,this,r).call(n=>n.selectAll().data(h?E(t,h,this.z):[t]).enter().call(u=>u.append("path").attr("fill","none").call(y,this).call(k,this,{...s,fill:null,fillOpacity:null}).attr("d",p=>this._renderLine(p,l,f)).call(o&&!N(this.fill)?p=>p.select(T).attr("stroke","none").call(y,this).call(k,this,{...s,stroke:null,strokeOpacity:null,strokeWidth:null}).attr("d",a=>this._renderBand(a,l,f)):()=>{}))).node()}}function T(){return this.parentNode.insertBefore(this.ownerDocument.createElementNS(L.svg,"path"),this)}class b extends P{constructor(t,r){super(t,r)}_renderBand(t,r,s){const{ci:i,precision:c}=this,[l,f]=x(t,n=>r[n]),h=w(t,r,s),o=H(t,r,s,(1-i)/2,h);return _().x(n=>n).y0(n=>o(n,-1)).y1(n=>o(n,1))(Z(l,f-c/2,c).concat(f))}_renderLine(t,r,s){const[i,c]=x(t,f=>r[f]),l=w(t,r,s);return`M${i},${l(i)}L${c},${l(c)}`}}function X(e,t={}){const{x:r=z,y:s=$,stroke:i,fill:c=O(i)?"currentColor":i,...l}=t;return new b(e,R({...l,x:r,y:s,fill:c,stroke:i}))}function w(e,t,r){let s=0,i=0,c=0,l=0;for(const n of e){const u=t[n],p=r[n];s+=u,i+=p,c+=u*p,l+=u*u}const f=e.length,h=(f*c-s*i)/(f*l-s*s),o=(i-h*s)/f;return n=>h*n+o}function H(e,t,r,s,i){const c=S(e,n=>t[n])/e.length;let l=0,f=0;for(const n of e)l+=(t[n]-c)**2,f+=(r[n]-i(t[n]))**2;const h=Math.sqrt(f/(e.length-2)),o=W(s,e.length-2);return(n,u)=>{const p=i(n),a=h*Math.sqrt(1/e.length+(n-c)**2/l);return p+u*o*a}}export{X as l};
