import{w as jn,a as Kn,c as v}from"./array.5d986d8c.js";import{c as Pn}from"./linear.74a9706a.js";import{x as Zn,y as Nn,s as Vn}from"./line.1fe94a3b.js";import"./transform.2ac1f063.js";import{B as nn,C as Un,D as Wn,E as $,k as C,F as en,n as qn,m as tn,G as Hn,H as Jn,I as Qn,J as En,K as _n,L as ne,N as ee,O as te,P as re,Q as oe,i as un,v as D,R as ce,S as rn,T as ie,U as ln,V as se,W as ae,X as ue,f as fn,Y as le,Z as fe,_ as de,M as me,$ as he,a0 as ye,a1 as pe,a2 as on,c as be,a as ge,b as xe,d as Ie,a3 as ve,e as Be,a4 as ke,a5 as cn,a6 as we,a7 as Ce}from"./plot.81b3b730.js";import{k as Xe,j as Me,d as Se}from"./continuous.a94dc564.js";import{e as L}from"./extent.4cf1c809.js";import{a as R}from"./path.1bc61eb4.js";function N(n,e){let t=0;if(e===void 0)for(let o of n)o!=null&&(o=+o)>=o&&++t;else{let o=-1;for(let i of n)(i=e(i,++o,n))!=null&&(i=+i)>=i&&++t}return t}function Fe(n){return Math.max(1,Math.ceil(Math.log(N(n))/Math.LN2)+1)}function Ge(n,e,t){const o=N(n),i=nn(n,.75)-nn(n,.25);return o&&i?Math.ceil((t-e)/(2*i*Math.pow(o,-1/3))):1}function dn(n,e,t){const o=N(n),i=Un(n);return o&&i?Math.ceil((t-e)*Math.cbrt(o)/(3.49*i)):1}function ft(n,e,t){var o=null,i=v(!0),a=null,l=Pn,d=null,f=jn(s);n=typeof n=="function"?n:n===void 0?Zn:v(+n),e=typeof e=="function"?e:e===void 0?v(0):v(+e),t=typeof t=="function"?t:t===void 0?Nn:v(+t);function s(r){var c,m,y,g=(r=Kn(r)).length,p,b=!1,x,k=new Array(g),w=new Array(g);for(a==null&&(d=l(x=f())),c=0;c<=g;++c){if(!(c<g&&i(p=r[c],c,r))===b)if(b=!b)m=c,d.areaStart(),d.lineStart();else{for(d.lineEnd(),d.lineStart(),y=c-1;y>=m;--y)d.point(k[y],w[y]);d.lineEnd(),d.areaEnd()}b&&(k[c]=+n(p,c,r),w[c]=+e(p,c,r),d.point(o?+o(p,c,r):k[c],t?+t(p,c,r):w[c]))}if(x)return d=null,x+""||null}function u(){return Vn().defined(i).curve(l).context(a)}return s.x=function(r){return arguments.length?(n=typeof r=="function"?r:v(+r),o=null,s):n},s.x0=function(r){return arguments.length?(n=typeof r=="function"?r:v(+r),s):n},s.x1=function(r){return arguments.length?(o=r==null?null:typeof r=="function"?r:v(+r),s):o},s.y=function(r){return arguments.length?(e=typeof r=="function"?r:v(+r),t=null,s):e},s.y0=function(r){return arguments.length?(e=typeof r=="function"?r:v(+r),s):e},s.y1=function(r){return arguments.length?(t=r==null?null:typeof r=="function"?r:v(+r),s):t},s.lineX0=s.lineY0=function(){return u().x(n).y(e)},s.lineY1=function(){return u().x(n).y(t)},s.lineX1=function(){return u().x(o).y(e)},s.defined=function(r){return arguments.length?(i=typeof r=="function"?r:v(!!r),s):i},s.curve=function(r){return arguments.length?(l=r,a!=null&&(d=l(a)),s):l},s.context=function(r){return arguments.length?(r==null?a=d=null:d=l(a=r),s):a},s}function Ae(n={y:"count"},e={}){[n,e]=De(n,e);const{x:t,y:o}=e;return ze(Oe(t,e,un),null,null,o,n,Wn(e))}function Ye(n,e,t={}){return(t==null?void 0:t.interval)==null?t:n({[e]:(t==null?void 0:t.reduce)===void 0?fe:t.reduce,filter:null},t)}function dt(n){return Ye(Ae,"y",n)}function ze(n,e,t,o,{data:i=Hn,filter:a=Jn,sort:l,reverse:d,...f}={},s={}){n=sn(n),e=sn(e),f=$e(f,s),i=yn(i,un),l=l==null?void 0:mn("sort",l,s),a=a==null?void 0:hn("filter",a,s),t!=null&&$(f,"x","x1","x2")&&(t=null),o!=null&&$(f,"y","y1","y2")&&(o=null);const[u,r]=C(n),[c,m]=C(n),[y,g]=C(e),[p,b]=C(e),[x,k]=t!=null?[t,"x"]:o!=null?[o,"y"]:[],[w,F]=C(x),{x:h,y:B,z:j,fill:U,stroke:W,x1:bn,x2:gn,y1:xn,y2:In,domain:_e,cumulative:nt,thresholds:et,interval:tt,...vn}=s,[Bn,kn]=C(j),[q]=en(U),[H]=en(W),[wn,Cn]=C(q),[Xn,Mn]=C(H);return{..."z"in s&&{z:Bn||j},..."fill"in s&&{fill:wn||U},..."stroke"in s&&{stroke:Xn||W},...qn(vn,(I,K)=>{const P=D(I,x),G=D(I,j),A=D(I,q),Y=D(I,H),T=ce(f,{z:G,fill:A,stroke:Y}),Z=[],J=[],Sn=P&&F([]),Fn=G&&kn([]),Gn=A&&Cn([]),An=Y&&Mn([]),Q=n&&r([]),Yn=n&&m([]),E=e&&g([]),zn=e&&b([]),Dn=Ke(n==null?void 0:n(I),e==null?void 0:e(I));let On=0;for(const S of f)S.initialize(I);l&&l.initialize(I),a&&a.initialize(I);for(const S of K){const _=[];for(const z of f)z.scope("facet",S);l&&l.scope("facet",S),a&&a.scope("facet",S);for(const[z,Tn]of rn(S,T))for(const[$n,Ln]of rn(Tn,P))for(const[X,M]of Dn(Ln))if(!(a&&!a.reduce(X,M))){_.push(On++),J.push(i.reduceIndex(X,I,M)),P&&Sn.push($n),G&&Fn.push(T===G?z:G[X[0]]),A&&Gn.push(T===A?z:A[X[0]]),Y&&An.push(T===Y?z:Y[X[0]]),Q&&(Q.push(M.x1),Yn.push(M.x2)),E&&(E.push(M.y1),zn.push(M.y2));for(const Rn of f)Rn.reduce(X,M);l&&l.reduce(X)}Z.push(_)}return ie(Z,l,d),{data:J,facets:Z}}),...!$(f,"x")&&(u?{x1:u,x2:c,x:tn(u,c)}:{x:h,x1:bn,x2:gn}),...!$(f,"y")&&(y?{y1:y,y2:p,y:tn(y,p)}:{y:B,y1:xn,y2:In}),...w&&{[k]:w},...Object.fromEntries(f.map(({name:I,output:K})=>[I,K]))}}function De({cumulative:n,domain:e,thresholds:t,interval:o,...i},a){return[i,{cumulative:n,domain:e,thresholds:t,interval:o,...a}]}function Oe(n,{cumulative:e,domain:t,thresholds:o,interval:i},a){return n={...Qn(n)},n.domain===void 0&&(n.domain=t),n.cumulative===void 0&&(n.cumulative=e),n.thresholds===void 0&&(n.thresholds=o),n.interval===void 0&&(n.interval=i),n.value===void 0&&(n.value=a),n.thresholds=Te(n.thresholds,n.interval),n}function sn(n){if(n==null)return;const{value:e,cumulative:t,domain:o=L,thresholds:i}=n,a=l=>{let d=D(l,e),f;if(ln(d)||Re(i)){d=se(d,ae,Float64Array);let[u,r]=typeof o=="function"?o(d):o,c=typeof i=="function"&&!O(i)?i(d,u,r):i;typeof c=="number"&&(c=ue(u,r,c)),O(c)&&(o===L&&(u=c.floor(u),r=c.offset(c.floor(r))),c=c.range(u,c.offset(r))),f=c}else{d=fn(d);let[u,r]=typeof o=="function"?o(d):o,c=typeof i=="function"&&!O(i)?i(d,u,r):i;if(typeof c=="number")if(o===L){let m=Xe(u,r,c);if(isFinite(m))if(m>0){let y=Math.round(u/m),g=Math.round(r/m);y*m<=u||--y,g*m>r||++g;let p=g-y+1;c=new Float64Array(p);for(let b=0;b<p;++b)c[b]=(y+b)*m}else if(m<0){m=-m;let y=Math.round(u*m),g=Math.round(r*m);y/m<=u||--y,g/m>r||++g;let p=g-y+1;c=new Float64Array(p);for(let b=0;b<p;++b)c[b]=(y+b)/m}else c=[u];else c=[u]}else c=Me(u,r,c);else O(c)&&(o===L&&(u=c.floor(u),r=c.offset(c.floor(r))),c=c.range(u,c.offset(r)));f=c}const s=[];if(f.length===1)s.push([f[0],f[0]]);else for(let u=1;u<f.length;++u)s.push([f[u-1],f[u]]);return s.bin=(t<0?Ze:t>0?Pe:V)(s,f,d),s};return a.label=En(e),a}function Te(n,e,t=an){if(n===void 0)return e===void 0?t:_n(e);if(typeof n=="string"){switch(n.toLowerCase()){case"freedman-diaconis":return Ge;case"scott":return dn;case"sturges":return Fe;case"auto":return an}return ne(n)}return n}function $e(n,e){return ee(n,e,mn)}function mn(n,e,t){return te(n,e,t,hn)}function hn(n,e,t){return re(n,e,t,yn)}function yn(n,e){return oe(n,e,Le)}function Le(n){switch(`${n}`.toLowerCase()){case"x":return Ne;case"x1":return Ue;case"x2":return We;case"y":return Ve;case"y1":return qe;case"y2":return He}throw new Error(`invalid bin reduce: ${n}`)}function an(n,e,t){return Math.min(200,dn(n,e,t))}function Re(n){return je(n)||le(n)&&ln(n)}function je(n){return O(n)&&typeof n=="function"&&n()instanceof Date}function O(n){return typeof(n==null?void 0:n.range)=="function"}function Ke(n,e){return n&&e?function*(t){const o=n.bin(t);for(const[i,[a,l]]of n.entries()){const d=e.bin(o[i]);for(const[f,[s,u]]of e.entries())yield[d[f],{x1:a,y1:s,x2:l,y2:u}]}}:n?function*(t){const o=n.bin(t);for(const[i,[a,l]]of n.entries())yield[o[i],{x1:a,x2:l}]}:function*(t){const o=e.bin(t);for(const[i,[a,l]]of e.entries())yield[o[i],{y1:a,y2:l}]}}function V(n,e,t){return e=fn(e),o=>{var a;const i=n.map(()=>[]);for(const l of o)(a=i[Se(e,t[l])-1])==null||a.push(l);return i}}function Pe(n,e,t){const o=V(n,e,t);return i=>{const a=o(i);for(let l=1,d=a.length;l<d;++l){const f=a[l-1],s=a[l];for(const u of f)s.push(u)}return a}}function Ze(n,e,t){const o=V(n,e,t);return i=>{const a=o(i);for(let l=a.length-2;l>=0;--l){const d=a[l+1],f=a[l];for(const s of d)f.push(s)}return a}}function pn(n,e){const t=(+n+ +e)/2;return n instanceof Date?new Date(t):t}const Ne={reduceIndex(n,e,{x1:t,x2:o}){return pn(t,o)}},Ve={reduceIndex(n,e,{y1:t,y2:o}){return pn(t,o)}},Ue={reduceIndex(n,e,{x1:t}){return t}},We={reduceIndex(n,e,{x2:t}){return t}},qe={reduceIndex(n,e,{y1:t}){return t}},He={reduceIndex(n,e,{y2:t}){return t}},Je={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function Qe(n){return n.sort===void 0&&n.reverse===void 0?ke({channel:"r",order:"descending"},n):n}class Ee extends me{constructor(e,t={}){const{x:o,y:i,r:a,rotate:l,symbol:d=on,frameAnchor:f}=t,[s,u]=cn(l,0),[r,c]=he(d),[m,y]=cn(a,r==null?3:4.5);super(e,{x:{value:o,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},r:{value:m,scale:"r",filter:ye,optional:!0},rotate:{value:s,optional:!0},symbol:{value:r,scale:"auto",optional:!0}},Qe(t),Je),this.r=y,this.rotate=u,this.symbol=c,this.frameAnchor=pe(f);const{channels:g}=this,{symbol:p}=g;if(p){const{fill:b,stroke:x}=g;p.hint={fill:b?b.value===p.value?"color":"currentColor":this.fill,stroke:x?x.value===p.value?"color":"currentColor":this.stroke}}}render(e,t,o,i,a){const{x:l,y:d}=t,{x:f,y:s,r:u,rotate:r,symbol:c}=o,{r:m,rotate:y,symbol:g}=this,[p,b]=we(this,i),x=this.symbol===on,k=u?void 0:m*m*Math.PI;return Ce(m)&&(e=[]),be("svg:g",a).call(ge,this,i,a).call(xe,this,{x:f&&l,y:s&&d}).call(w=>w.selectAll().data(e).enter().append(x?"circle":"path").call(Ie,this).call(x?F=>{F.attr("cx",f?h=>f[h]:p).attr("cy",s?h=>s[h]:b).attr("r",u?h=>u[h]:m)}:F=>{F.attr("transform",ve`translate(${f?h=>f[h]:p},${s?h=>s[h]:b})${r?h=>` rotate(${r[h]})`:y?` rotate(${y})`:""}`).attr("d",u&&c?h=>{const B=R();return c[h].draw(B,u[h]*u[h]*Math.PI),B}:u?h=>{const B=R();return g.draw(B,u[h]*u[h]*Math.PI),B}:c?h=>{const B=R();return c[h].draw(B,k),B}:(()=>{const h=R();return g.draw(h,k),h})())}).call(Be,this,o)).node()}}function mt(n,e={}){let{x:t,y:o,...i}=e;return e.frameAnchor===void 0&&([t,o]=de(t,o)),new Ee(n,{...i,x:t,y:o})}export{Ae as b,mt as d,dt as m,ft as s,Fe as t};
